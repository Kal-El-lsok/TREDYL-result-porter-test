<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Nursery Results - TREDYL SCHOOLS</title>
    
    <!-- SIMPLE FIREBASE SETUP -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBbswCKXHCr_d_CKY3Ad2WQyflvg7bJV94",
            authDomain: "tredyl-schools.firebaseapp.com",
            databaseURL: "https://tredyl-schools-default-rtdb.firebaseio.com",
            projectId: "tredyl-schools",
            storageBucket: "tredyl-schools.firebasestorage.app",
            messagingSenderId: "810112149886",
            appId: "1:810112149886:web:0f915a9c6e7f2cc1cdab2f"
        };
    </script>
    
    <!-- Load Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <link rel="stylesheet" href="select class.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .prenursery-container { max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .prenursery-form { background: white; border-radius: 15px; padding: 2.5rem; box-shadow: 0 10px 30px rgba(245, 158, 11, 0.1); text-align: center; border-top: 5px solid #f59e0b; }
        .prenursery-icon { font-size: 3.5rem; color: #f59e0b; margin-bottom: 1rem; }
        .prenursery-title { color: #d97706; margin-bottom: 0.5rem; }
        .roll-input-prenursery { width: 100%; padding: 15px; margin: 1.5rem 0; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1.1rem; text-align: center; font-family: 'Courier New', monospace; font-weight: bold; }
        .check-btn-prenursery { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; }
        .error-box-prenursery { background: #fee2e2; color: #dc2626; padding: 1rem; border-radius: 8px; margin-top: 1rem; display: none; align-items: center; justify-content: center; gap: 10px; }
        .access-denied-box { background: #fef3c7; color: #92400e; padding: 1.5rem; border-radius: 10px; margin-top: 1rem; display: none; text-align: center; border-left: 4px solid #f59e0b; }
        .results-box-prenursery { background: white; border-radius: 15px; padding: 2.5rem; box-shadow: 0 10px 30px rgba(245, 158, 11, 0.1); margin-top: 2rem; display: none; border-top: 5px solid #10b981; }
        .student-header-prenursery { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; text-align: center; }
        .action-buttons-prenursery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 2rem; }
        .action-btn-prenursery { padding: 1.5rem 1rem; border: none; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.8rem; font-weight: 600; }
        .roll-display-result { font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold; }
    </style>
</head>
<body>
    <section class="header">
        <nav>
            <a href="index.html" class="logo"><img src="logo-removebg-preview.png" alt="TREDYL Schools Logo"></a>
            <div class="nav-links" id="navLinks">
                <i class="fa fa-times" onclick="hideMenu()"></i>
                <ul>
                    <li><a href="index.html">PORTAL HOME</a></li>
                    <li><a href="print result.html">PRINT RESULT</a></li>
                    <li><a href="print news.html">NEWSLETTER</a></li>
                </ul>
            </div>
            <i class="fa fa-bars" onclick="showMenu()"></i>
        </nav>

        <div class="prenursery-container">
            <div class="back-nav">
                <a href="select class.html" class="back-btn"><i class="fas fa-arrow-left"></i> BACK TO CLASS SELECTION</a>
            </div>

            <div class="prenursery-form">
                <div class="prenursery-icon"><i class="fas fa-baby"></i></div>
                <h1 class="prenursery-title">PRE-NURSERY RESULTS</h1>
                <p>First Term 2025/2026 Academic Session</p>
                
                <input type="text" id="rollNumber" class="roll-input-prenursery" placeholder="Enter 8-digit roll number" autofocus maxlength="8">
                
                <button class="check-btn-prenursery" id="checkBtn"><i class="fas fa-search"></i> CHECK RESULT</button>
                
                <div class="error-box-prenursery" id="errorBox">
                    <i class="fas fa-exclamation-circle"></i><span id="errorText">Invalid roll number</span>
                </div>
                
                <div class="access-denied-box" id="accessDeniedBox">
                    <i class="fas fa-lock"></i>
                    <h3 style="margin-bottom: 10px;">RESULT NOT AVAILABLE</h3>
                    <p>Your result is currently not available. Please complete your school fees to access your result.</p>
                    <p style="margin-top: 10px; font-weight: 500;"><i class="fas fa-phone"></i> Contact School: +234 802 833 2430</p>
                </div>
            </div>

            <div class="results-box-prenursery" id="resultsBox">
                <div class="student-header-prenursery">
                    <h2 id="studentName" style="font-size: 1.8rem; margin-bottom: 10px;">STUDENT NAME</h2>
                    <p style="opacity: 0.9; margin-bottom: 5px;">
                        <i class="fas fa-id-card"></i> Roll Number: <strong class="roll-display-result" id="displayRoll">20203425</strong>
                    </p>
                    <p style="opacity: 0.9;"><i class="fas fa-school"></i> Class: <strong>Pre-Nursery</strong></p>
                </div>
                
                <p style="text-align: center; font-size: 1.1rem; color: #475569; margin-bottom: 1rem;">Your First Term result is ready. Choose an option below:</p>
                
                <div class="action-buttons-prenursery">
                    <button class="action-btn-prenursery print-btn-prenursery" id="printBtn"><i class="fas fa-print"></i><span>PRINT RESULT</span></button>
                    <button class="action-btn-prenursery download-btn-prenursery" id="downloadBtn"><i class="fas fa-download"></i><span>DOWNLOAD PDF</span></button>
                    <button class="action-btn-prenursery share-btn-prenursery" id="shareBtn"><i class="fas fa-share-alt"></i><span>SHARE RESULT</span></button>
                </div>
                
                <div class="instructions-box" style="margin-top: 1.5rem;">
                    <p><i class="fas fa-lightbulb"></i> <strong>Note:</strong> PDF will be downloaded as <code id="pdfFileName">20203425.pdf</code></p>
                </div>
            </div>
        </div>

        <footer>
            <div class="footer-content">
                <div class="footer-links">
                    <a href="index.html" class="footer-link"><i class="fas fa-home"></i><span>PORTAL HOME</span></a>
                    <a href="print result.html" class="footer-link"><i class="fas fa-print"></i><span>PRINT RESULT</span></a>
                    <a href="print news.html" class="footer-link"><i class="fas fa-newspaper"></i><span>NEWSLETTER</span></a>
                    <a href="https://kal-el-lsok.github.io/KAL-EL-PORTFOLIO/" class="footer-link"><i class="fas fa-code"></i><span>DEVELOPER</span></a>
                </div>

                <div class="footer-info">
                    <div class="school-info">
                        <img src="logo-removebg-preview.png" class="footer-logo" alt="TREDYL Logo">
                        <p>TREDYL International Schools Results Portal<br>First Term Examination Results 2025/2026</p>
                    </div>

                    <div class="support-info">
                        <h4><i class="fas fa-headset"></i> PRE-NURSERY SUPPORT</h4>
                        <p>For Pre-Nursery result inquiries:</p>
                        <p><i class="fas fa-envelope"></i> prenursery@tredylschools.edu.ng</p>
                        <p><i class="fas fa-phone"></i> +234 802 833 2430</p>
                        <p><i class="fas fa-clock"></i> 8:00 AM - 4:00 PM (Weekdays)</p>
                    </div>
                </div>

                <div class="footer-bottom">
                    <p class="copyright">&copy; 2025 Tredyl International School - First Term Results Portal. All rights reserved.<br>Developed with <i class="fas fa-heart"></i> by KAL-EL</p>
                </div>
            </div>
        </footer>
    </section>

    <script>
        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log("✅ Student: Firebase ready");
        } catch (error) {
            console.error("Firebase error:", error);
        }
        
        // MOBILE MENU
        function showMenu() { 
            document.getElementById("navLinks").classList.add("active"); 
        }
        
        function hideMenu() { 
            document.getElementById("navLinks").classList.remove("active"); 
        }

        // CHECK RESULT
        async function checkResult() {
            console.log("Check result clicked");
            const rollNumber = document.getElementById('rollNumber').value.trim();
            const errorBox = document.getElementById('errorBox');
            const accessDeniedBox = document.getElementById('accessDeniedBox');
            const resultsBox = document.getElementById('resultsBox');
            
            errorBox.style.display = 'none';
            accessDeniedBox.style.display = 'none';
            resultsBox.style.display = 'none';
            
            if (!rollNumber || rollNumber.length !== 8 || !/^\d+$/.test(rollNumber)) {
                document.getElementById('errorText').textContent = 'Enter valid 8-digit roll number';
                errorBox.style.display = 'flex';
                return;
            }
            
            try {
                if (!database) {
                    document.getElementById('errorText').textContent = 'System error. Refresh page.';
                    errorBox.style.display = 'flex';
                    return;
                }
                
                const snapshot = await database.ref('students/preNursery').once('value');
                const students = snapshot.val();
                
                if (!students) {
                    document.getElementById('errorText').textContent = 'No student data found';
                    errorBox.style.display = 'flex';
                    return;
                }
                
                const student = students.find(s => s.rollNumber === rollNumber);
                
                if (student) {
                    if (student.access) {
                        document.getElementById('studentName').textContent = student.fullName;
                        document.getElementById('displayRoll').textContent = rollNumber;
                        document.getElementById('pdfFileName').textContent = student.pdfName;
                        resultsBox.style.display = 'block';
                        console.log("✅ Access granted for:", student.fullName);
                    } else {
                        accessDeniedBox.style.display = 'block';
                        console.log("❌ Access denied for:", student.fullName);
                    }
                } else {
                    document.getElementById('errorText').textContent = 'Roll number not found';
                    errorBox.style.display = 'flex';
                }
            } catch (error) {
                console.error("Check result error:", error);
                document.getElementById('errorText').textContent = 'Network error. Try again.';
                errorBox.style.display = 'flex';
            }
        }

        // PRINT RESULT
        function printResult() {
            const studentName = document.getElementById('studentName').textContent;
            const rollNumber = document.getElementById('displayRoll').textContent;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head><title>${studentName} - Result</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                    .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #f59e0b; padding-bottom: 20px; }
                </style>
                </head>
                <body>
                    <div class="header">
                        <h1 style="color: #d97706;">TREDYL INTERNATIONAL SCHOOLS</h1>
                        <h2>PRE-NURSERY - FIRST TERM RESULT SLIP</h2>
                        <p>2025/2026 Academic Session</p>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3>STUDENT INFORMATION</h3>
                        <p><strong>Name:</strong> ${studentName}</p>
                        <p><strong>Roll Number:</strong> ${rollNumber}</p>
                        <p><strong>Class:</strong> Pre-Nursery</p>
                        <p><strong>Term:</strong> First Term 2025/2026</p>
                        <p><strong>Date Printed:</strong> ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() {
                                window.close();
                            }, 1000);
                        }
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // DOWNLOAD PDF
        function downloadPDF() {
            const rollNumber = document.getElementById('displayRoll').textContent;
            const studentName = document.getElementById('studentName').textContent;
            const pdfName = `${rollNumber}.pdf`;
            
            const link = document.createElement('a');
            link.href = `results/prenursery/${pdfName}`;
            link.download = pdfName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`Downloading: ${pdfName}\nStudent: ${studentName}`);
        }

        // SHARE RESULT
        function shareResult() {
            const studentName = document.getElementById('studentName').textContent;
            const rollNumber = document.getElementById('displayRoll').textContent;
            const shareText = `TREDYL Schools - Pre-Nursery Result\nStudent: ${studentName}\nRoll: ${rollNumber}\nTerm: First Term 2025/2026`;
            
            if (navigator.share) {
                navigator.share({ title: 'My Pre-Nursery Result', text: shareText });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('✅ Result copied to clipboard!');
                });
            }
        }

        // INITIALIZE
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Student page loaded");
            
            document.getElementById('checkBtn').addEventListener('click', checkResult);
            document.getElementById('printBtn').addEventListener('click', printResult);
            document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
            document.getElementById('shareBtn').addEventListener('click', shareResult);
            
            document.getElementById('rollNumber').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') checkResult();
            });
            
            document.getElementById('rollNumber').addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '').slice(0, 8);
            });
            
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => hideMenu());
            });
        });
    </script>
</body>
</html>